\doxysection{A3\+G4250\+D.\+c}
\hypertarget{_a3_g4250_d_8c_source}{}\label{_a3_g4250_d_8c_source}\index{Core/Src/SPI/sensors/gyro/A3G4250D.c@{Core/Src/SPI/sensors/gyro/A3G4250D.c}}
\mbox{\hyperlink{_a3_g4250_d_8c}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00001}00001\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{_a3_g4250_d_8h}{A3G4250D.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00002}00002\ }
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00009}00009\ \textcolor{comment}{/*\ ===============================================================================\ */}}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00020}\mbox{\hyperlink{group___a3_g4250_d_gabd9827bb607041567765c6a476461d18}{00020}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{group___a3_g4250_d_gabd9827bb607041567765c6a476461d18}{A3G4250D\_init}}(\mbox{\hyperlink{struct_a3_g4250_d}{A3G4250D}}\ *gyro,\ GPIO\_TypeDef\ *port,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ cs,\ \textcolor{keywordtype}{float}\ sensitivity,\ \textcolor{keyword}{const}\ uint8\_t\ *axes)\ \{}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00021}00021\ \ \ \mbox{\hyperlink{group___s_p_i_ga656f7b06a728e76eb9ac0b10e1bd5bb7}{SPI\_init}}(\&gyro-\/>base,\ \mbox{\hyperlink{group___s_p_i_ggad258d4c51629346fceac4679b3209ad9a84b967fe10b7c1cfe2f779d99407703a}{SENSOR\_GYRO}},\ SPI1,\ port,\ cs);}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00022}00022\ \ \ gyro-\/>sensitivity\ \ \ \ \ =\ sensitivity;}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00023}00023\ \ \ gyro-\/>axes\ \ \ \ \ \ \ \ \ \ \ \ =\ axes;}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00024}00024\ \ \ gyro-\/>readGyro\ \ \ \ \ \ \ \ =\ \mbox{\hyperlink{group___a3_g4250_d_ga312e2655fabf3e10b2f71c90d8e1634d}{A3G4250D\_readGyro}};}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00025}00025\ \ \ gyro-\/>readRawBytes\ \ \ \ =\ \mbox{\hyperlink{group___a3_g4250_d_gadd64ac77b1a4f0414abc10dd0e8ab8ef}{A3G4250D\_readRawBytes}};}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00026}00026\ \ \ gyro-\/>processRawBytes\ =\ \mbox{\hyperlink{group___a3_g4250_d_ga0b884ae90373ad5fa4565610707ea198}{A3G4250D\_processRawBytes}};}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00027}00027\ }
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00028}00028\ \ \ A3G4250D\_writeRegister(gyro,\ A3G4250D\_CTRL\_REG1,\ A3G4250D\_CTRL\_REG1\_ODR\_800Hz\ |\ A3G4250D\_CTRL\_REG1\_AXIS\_ENABLE\ |\ A3G4250D\_CTRL\_REG1\_PD\_ENABLE);}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00029}00029\ \}}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00030}00030\ }
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00031}00031\ \textcolor{comment}{/********************************\ DEVICE\ METHODS\ ********************************/}}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00032}00032\ }
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00033}00033\ \textcolor{comment}{/*\ ===============================================================================\ */}}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00041}\mbox{\hyperlink{group___a3_g4250_d_ga312e2655fabf3e10b2f71c90d8e1634d}{00041}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{group___a3_g4250_d_ga312e2655fabf3e10b2f71c90d8e1634d}{A3G4250D\_readGyro}}(\mbox{\hyperlink{struct_a3_g4250_d}{A3G4250D}}\ *gyro,\ \textcolor{keywordtype}{float}\ *out)\ \{}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00042}00042\ \ \ uint8\_t\ bytes[A3G4250D\_DATA\_TOTAL];}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00043}00043\ \ \ gyro-\/>readRawBytes(gyro,\ bytes);}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00044}00044\ \ \ gyro-\/>processRawBytes(gyro,\ bytes,\ out);}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00045}00045\ \}}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00046}00046\ }
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00047}00047\ \textcolor{comment}{/*\ ===============================================================================\ */}}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00056}\mbox{\hyperlink{group___a3_g4250_d_ga0b884ae90373ad5fa4565610707ea198}{00056}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{group___a3_g4250_d_ga0b884ae90373ad5fa4565610707ea198}{A3G4250D\_processRawBytes}}(\mbox{\hyperlink{struct_a3_g4250_d}{A3G4250D}}\ *gyro,\ uint8\_t\ *bytes,\ \textcolor{keywordtype}{float}\ *out)\ \{}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00057}00057\ \ \ out[0]\ =\ gyro-\/>sensitivity\ *\ (int16\_t)(((uint16\_t)bytes[0]\ <<\ 8)\ |\ bytes[1]);\ \textcolor{comment}{//\ gyro\ X}}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00058}00058\ \ \ out[1]\ =\ gyro-\/>sensitivity\ *\ (int16\_t)(((uint16\_t)bytes[2]\ <<\ 8)\ |\ bytes[3]);\ \textcolor{comment}{//\ gyro\ Y}}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00059}00059\ \ \ out[2]\ =\ gyro-\/>sensitivity\ *\ (int16\_t)(((uint16\_t)bytes[4]\ <<\ 8)\ |\ bytes[5]);\ \textcolor{comment}{//\ gyro\ Z}}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00060}00060\ \}}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00061}00061\ }
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00062}00062\ \textcolor{comment}{/*\ ===============================================================================\ */}}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00070}\mbox{\hyperlink{group___a3_g4250_d_gadd64ac77b1a4f0414abc10dd0e8ab8ef}{00070}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{group___a3_g4250_d_gadd64ac77b1a4f0414abc10dd0e8ab8ef}{A3G4250D\_readRawBytes}}(\mbox{\hyperlink{struct_a3_g4250_d}{A3G4250D}}\ *gyro,\ uint8\_t\ *out)\ \{}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00071}00071\ \ \ out[0]\ =\ A3G4250D\_readRegister(gyro,\ A3G4250D\_OUT\_X\_H);\ \textcolor{comment}{//\ gyro\ X\ high}}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00072}00072\ \ \ out[1]\ =\ A3G4250D\_readRegister(gyro,\ A3G4250D\_OUT\_X\_L);\ \textcolor{comment}{//\ gyro\ X\ low}}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00073}00073\ \ \ out[2]\ =\ A3G4250D\_readRegister(gyro,\ A3G4250D\_OUT\_Y\_H);\ \textcolor{comment}{//\ gyro\ Y\ high}}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00074}00074\ \ \ out[3]\ =\ A3G4250D\_readRegister(gyro,\ A3G4250D\_OUT\_Y\_L);\ \textcolor{comment}{//\ gyro\ Y\ low}}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00075}00075\ \ \ out[4]\ =\ A3G4250D\_readRegister(gyro,\ A3G4250D\_OUT\_Z\_H);\ \textcolor{comment}{//\ gyro\ Z\ high}}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00076}00076\ \ \ out[5]\ =\ A3G4250D\_readRegister(gyro,\ A3G4250D\_OUT\_Z\_L);\ \textcolor{comment}{//\ gyro\ Z\ low}}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00077}00077\ \}}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00078}00078\ }
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00079}00079\ \textcolor{comment}{/********************************\ INTERFACE\ METHODS\ ********************************/}}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00080}00080\ }
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00081}00081\ \textcolor{keywordtype}{void}\ A3G4250D\_writeRegister(\mbox{\hyperlink{struct_a3_g4250_d}{A3G4250D}}\ *gyro,\ uint8\_t\ address,\ uint8\_t\ data)\ \{}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00082}00082\ \ \ uint16\_t\ response;}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00083}00083\ \ \ \mbox{\hyperlink{struct_s_p_i}{SPI}}\ spi\ =\ gyro-\/>base;}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00084}00084\ }
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00085}00085\ \ \ \textcolor{comment}{//\ Send\ write\ command\ with\ address\ and\ data}}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00086}00086\ \ \ uint16\_t\ payload\ =\ (address\ <<\ 0x08)\ |\ data;}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00087}00087\ \ \ spi.\mbox{\hyperlink{struct_s_p_i_a82241972e0292c7de95ea1e293e11be3}{port}}-\/>ODR\ \&=\ \string~spi.cs;}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00088}00088\ \ \ spi.\mbox{\hyperlink{struct_s_p_i_a194e08b54d45d097bba08a024fb0826e}{send}}(\&spi,\ payload);}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00089}00089\ }
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00090}00090\ \ \ \textcolor{comment}{//\ Read\ in\ response\ from\ interface}}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00091}00091\ \ \ spi.\mbox{\hyperlink{struct_s_p_i_ac4444c9c043175f1ed173040fa123e2e}{receive}}(\&spi,\ \&response);}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00092}00092\ \ \ spi.\mbox{\hyperlink{struct_s_p_i_a82241972e0292c7de95ea1e293e11be3}{port}}-\/>ODR\ |=\ spi.\mbox{\hyperlink{struct_s_p_i_a8f467bedd92cfa29ba7b757711ece04d}{cs}};}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00093}00093\ \}}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00094}00094\ }
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00095}00095\ uint8\_t\ A3G4250D\_readRegister(\mbox{\hyperlink{struct_a3_g4250_d}{A3G4250D}}\ *gyro,\ uint8\_t\ address)\ \{}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00096}00096\ \ \ uint16\_t\ response;}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00097}00097\ \ \ \mbox{\hyperlink{struct_s_p_i}{SPI}}\ spi\ =\ gyro-\/>base;}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00098}00098\ }
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00099}00099\ \ \ \textcolor{comment}{//\ Send\ write\ command\ with\ address\ and\ data}}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00100}00100\ \ \ uint16\_t\ payload\ =\ (address\ <<\ 0x08)\ |\ 0x8000;}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00101}00101\ \ \ spi.\mbox{\hyperlink{struct_s_p_i_a82241972e0292c7de95ea1e293e11be3}{port}}-\/>ODR\ \&=\ \string~spi.cs;}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00102}00102\ \ \ spi.\mbox{\hyperlink{struct_s_p_i_a194e08b54d45d097bba08a024fb0826e}{send}}(\&spi,\ payload);}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00103}00103\ }
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00104}00104\ \ \ \textcolor{comment}{//\ Read\ in\ response\ from\ interface}}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00105}00105\ \ \ spi.\mbox{\hyperlink{struct_s_p_i_ac4444c9c043175f1ed173040fa123e2e}{receive}}(\&spi,\ \&response);}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00106}00106\ \ \ spi.\mbox{\hyperlink{struct_s_p_i_a82241972e0292c7de95ea1e293e11be3}{port}}-\/>ODR\ |=\ spi.\mbox{\hyperlink{struct_s_p_i_a8f467bedd92cfa29ba7b757711ece04d}{cs}};}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00107}00107\ \ \ \textcolor{keywordflow}{return}\ (uint8\_t)response;}
\DoxyCodeLine{\Hypertarget{_a3_g4250_d_8c_source_l00108}00108\ \}}

\end{DoxyCode}
