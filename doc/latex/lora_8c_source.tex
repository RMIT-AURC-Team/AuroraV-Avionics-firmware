\doxysection{lora.\+c}
\hypertarget{lora_8c_source}{}\label{lora_8c_source}\index{Core/Src/lora.c@{Core/Src/lora.c}}

\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00001}00001\ \textcolor{preprocessor}{\#include\ "{}lora.h"{}}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00002}00002\ }
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00003}00003\ \textcolor{comment}{/*\ SPI1\ LORA}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00004}00004\ \textcolor{comment}{\ *\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00005}00005\ \textcolor{comment}{\ *\ Flash\ Pin\ \ |\ MCU\ GPIO\ Pin\ \ |\ SIGNAL\ TYPE}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00006}00006\ \textcolor{comment}{\ *\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/|-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/|-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00007}00007\ \textcolor{comment}{\ *\ SDI\ \ \ \ \ \ \ \ |\ PC12\ \ \ \ \ \ \ \ \ \ |\ DATA}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00008}00008\ \textcolor{comment}{\ *\ SDO\ \ \ \ \ \ \ \ |\ PC11\ \ \ \ \ \ \ \ \ \ |\ DATA}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00009}00009\ \textcolor{comment}{\ *\ SCLK\ \ \ \ \ \ \ |\ PC10\ \ \ \ \ \ \ \ \ \ |\ DATA}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00010}00010\ \textcolor{comment}{\ *\ RST\ \ \ \ \ \ \ \ |\ PD7\ \ \ \ \ \ \ \ \ \ \ |\ CONTROL}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00011}00011\ \textcolor{comment}{\ *\ DI0\ \ \ \ \ \ \ \ |\ PD1\ \ \ \ \ \ \ \ \ \ \ |\ DATA}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00012}00012\ \textcolor{comment}{\ *\ CS\ \ \ \ \ \ \ \ \ |\ PD0\ \ \ \ \ \ \ \ \ \ \ |\ CONTROL\ \ \ \ \ \ */}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00013}00013\ }
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00014}00014\ \textcolor{keyword}{const}\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{struct_lo_ra___registers}{LoRa\_Registers}}\ \mbox{\hyperlink{struct_lo_ra___registers}{LoRa\_Registers}}\ =\ \{0,\ 1,\ 0xd,\ 0xE,\ 0xF,\ 0x10,\ 0x11,\ 0x12,\ 0x13,\ 0x14,\ 0x15,\ 0x16,\ 0x17,\ 0x18,\ 0x19,\ 0x1A,\ 0x1B,\ 0x1C,\ 0x1D,\ 0x1E,\ 0x1F,\ 0x20,\ 0x21,\ 0x22,\ 0x23,\ 0x24,\ 0x25,\ 0x28,\ 0x29,\ 0x2A,\ 0x2C,\ 0x31,\ 0x33,\ 0x37,\ 0x39,\ 0x3B,\ 0x3D,\ 0x40,\ 0x41\};}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00015}00015\ }
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00016}00016\ \textcolor{keywordtype}{void}\ configure\_SPI3\_LoRa()\ \{}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00017}00017\ \ \ GPIOC-\/>MODER\ \&=\ (\string~(GPIO\_MODER\_MODE10\_Msk\ |\ GPIO\_MODER\_MODE11\_Msk\ |\ GPIO\_MODER\_MODE12\_Msk));}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00018}00018\ \ \ GPIOC-\/>MODER\ |=\ ((0x2\ <<\ GPIO\_MODER\_MODE10\_Pos)\ |\ (0x2\ <<\ GPIO\_MODER\_MODE11\_Pos)\ |\ (0x2\ <<\ GPIO\_MODER\_MODE12\_Pos));}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00019}00019\ \ \ GPIOC-\/>PUPDR\ \&=\ (\string~(GPIO\_PUPDR\_PUPD10\_Msk\ |\ GPIO\_PUPDR\_PUPD11\_Msk\ |\ GPIO\_PUPDR\_PUPD12\_Msk));}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00020}00020\ \ \ GPIOC-\/>PUPDR\ |=\ ((0X1\ <<\ GPIO\_PUPDR\_PUPD10\_Pos)\ |\ (0X1\ <<\ GPIO\_PUPDR\_PUPD11\_Pos)\ |\ (0X1\ <<\ GPIO\_PUPDR\_PUPD12\_Pos));}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00021}00021\ \ \ GPIOD-\/>PUPDR\ |=\ (0X1\ <<\ GPIO\_PUPDR\_PUPD1\_Pos);}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00022}00022\ \ \ GPIOD-\/>MODER\ \&=\ (\string~(GPIO\_MODER\_MODE0\_Msk)\ |\ (GPIO\_MODER\_MODE7\_Msk)\ |\ (GPIO\_MODER\_MODE1\_Msk));}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00023}00023\ \ \ GPIOD-\/>MODER\ |=\ (0X01\ <<\ GPIO\_MODER\_MODE0\_Pos)\ |\ (0X01\ <<\ GPIO\_MODER\_MODE7\_Pos);\ \textcolor{comment}{//\ chip\ select\ stuff}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00024}00024\ \ \ TIM6-\/>ARR\ \ \ \ \&=\ (\string~(TIM\_ARR\_ARR\_Msk));}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00025}00025\ \ \ TIM6-\/>PSC\ \ \ \ \&=\ (\string~(TIM\_PSC\_PSC\_Msk));}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00026}00026\ \ \ TIM6-\/>ARR\ \ \ \ |=\ 20000;}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00027}00027\ \ \ TIM6-\/>PSC\ \ \ \ |=\ 251;}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00028}00028\ }
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00029}00029\ \ \ GPIOD-\/>ODR\ |=\ (GPIO\_ODR\_OD7);}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00030}00030\ \ \ TIM6-\/>CR1\ \ |=\ TIM\_CR1\_CEN;}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00031}00031\ \ \ \textcolor{keywordflow}{while}\ ((TIM6-\/>SR\ \&\ TIM\_SR\_UIF)\ ==\ 0);\ \textcolor{comment}{//\ 60\ ms\ delay}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00032}00032\ \ \ GPIOD-\/>ODR\ \&=\ (\string~(GPIO\_ODR\_OD7));}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00033}00033\ \ \ TIM6-\/>SR\ \ \ \&=\ \string~(TIM\_SR\_UIF);\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ clears\ UIF}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00034}00034\ }
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00035}00035\ \ \ GPIOC-\/>OTYPER\ \ \&=\ (\string~(GPIO\_OTYPER\_OT10\ |\ GPIO\_OTYPER\_OT11\ |\ GPIO\_OTYPER\_OT12));}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00036}00036\ \ \ GPIOC-\/>OSPEEDR\ \&=\ (\string~(GPIO\_OSPEEDR\_OSPEED10\_Msk\ |\ GPIO\_OSPEEDR\_OSPEED11\_Msk\ |\ GPIO\_OSPEEDR\_OSPEED12\_Msk));}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00037}00037\ \ \ GPIOC-\/>OSPEEDR\ |=\ (0x2\ <<\ GPIO\_OSPEEDR\_OSPEED10\_Pos\ |\ 0x2\ <<\ GPIO\_OSPEEDR\_OSPEED11\_Pos\ |\ 0x2\ <<\ GPIO\_OSPEEDR\_OSPEED12\_Pos);}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00038}00038\ \ \ GPIOD-\/>ODR\ \ \ \ \ |=\ GPIO\_ODR\_OD0;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ raise\ chip\ select}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00039}00039\ \ \ GPIOC-\/>AFR[1]\ \ \&=\ (uint32\_t)(\string~(0x000FFF00));\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ clears\ AFRH\ 10,\ 11\ and\ 12}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00040}00040\ \ \ GPIOC-\/>AFR[1]\ \ |=\ (0x00066600);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ sets\ AFRH\ 10,\ 11\ and\ 12\ to\ AF6\ for\ lora\ SPI}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00041}00041\ }
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00042}00042\ \ \ SPI3-\/>CR1\ \&=\ (\string~(SPI\_CR1\_BR\_Msk));}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00043}00043\ \ \ SPI3-\/>CR1\ |=\ (0x2\ <<\ SPI\_CR1\_BR\_Pos);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ set\ board\ rate\ too\ fclck\ /\ 16\ =\ 42/8\ =\ 5.25\ (10\ MHz\ max\ for\ LoRa)}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00044}00044\ \ \ SPI3-\/>CR1\ \&=\ (\string~(SPI\_CR1\_CPHA\_Msk)\ |\ (SPI\_CR1\_CPOL\_Msk));\ \textcolor{comment}{//\ sets\ CPOL\ and\ CPHA\ to\ zero\ as\ specified\ in\ LoRa\ datasheet}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00045}00045\ \ \ \textcolor{comment}{//\ needs\ bit\ DIO\ and\ Reset\ configured\ to\ idk\ what}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00046}00046\ \ \ SPI3-\/>CR1\ |=\ SPI\_CR1\_MSTR;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ micro\ is\ master}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00047}00047\ \ \ SPI3-\/>CR1\ |=\ SPI\_CR1\_SSM\ |\ SPI\_CR1\_SSI;\ \textcolor{comment}{//\ Software\ management}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00048}00048\ \ \ SPI3-\/>CR1\ \&=\ (\string~(SPI\_CR1\_LSBFIRST\_Msk));\ \textcolor{comment}{//\ MSB\ FIRST}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00049}00049\ \ \ SPI3-\/>CR1\ |=\ SPI\_CR1\_DFF;}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00050}00050\ \ \ SPI3-\/>CR1\ \&=\ \string~(SPI\_CR1\_BIDIMODE\ |\ SPI\_CR1\_RXONLY);}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00051}00051\ \ \ SPI3-\/>CR1\ |=\ (0x1\ <<\ SPI\_CR1\_SPE\_Pos);}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00052}00052\ \}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00053}00053\ }
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00054}00054\ \textcolor{keywordtype}{void}\ Load\_And\_Send\_To\_LoRa(\textcolor{keywordtype}{char}\ *pointerdata,\ \textcolor{keyword}{const}\ \textcolor{keyword}{struct}\ \mbox{\hyperlink{struct_lo_ra___registers}{LoRa\_Registers}}\ *\mbox{\hyperlink{struct_lo_ra___registers}{LoRa\_Registers}})\ \{}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00055}00055\ \ \ write\_lora\_packet(\mbox{\hyperlink{struct_lo_ra___registers}{LoRa\_Registers}}-\/>RegIrqFlags,\ 0X08);\ \ \ \ \textcolor{comment}{//\ clears\ the\ status\ flags}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00056}00056\ \ \ write\_lora\_packet(\mbox{\hyperlink{struct_lo_ra___registers}{LoRa\_Registers}}-\/>RegFifoAddrPtr,\ 0X80);\ \textcolor{comment}{//\ set\ pointer\ adddress\ to\ TX}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00057}00057\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ x\ =\ 0;\ x\ <\ 16;\ x++)\ \{}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00058}00058\ \ \ \ \ write\_lora\_packet(0x00,\ pointerdata[x]);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ load\ fifo}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00059}00059\ \ \ \}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00060}00060\ \ \ uint8\_t\ regopmode\ \ =\ 0;}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00061}00061\ \ \ regopmode\ \ \ \ \ \ \ \ \ \ =\ receive\_lora\_data(0X1);\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ read\ in\ current\ status}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00062}00062\ \ \ regopmode\ \ \ \ \ \ \ \ \ \&=\ (\textcolor{keywordtype}{unsigned}\ int)(\string~(0x7));\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ clear\ status\ bits}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00063}00063\ \ \ regopmode\ \ \ \ \ \ \ \ \ |=\ 0x3;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ or\ bits\ in}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00064}00064\ \ \ write\_lora\_packet(0x1,\ regopmode);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ set\ to\ transmit}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00065}00065\ }
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00066}00066\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ while\ (!(GPIOD-\/>IDR\ \&\ 0X2));\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ //\ wait\ for\ transmit\ complete}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00067}00067\ \ \ write\_lora\_packet(\mbox{\hyperlink{struct_lo_ra___registers}{LoRa\_Registers}}-\/>RegIrqFlags,\ 0X08);\ \textcolor{comment}{//\ clears\ the\ status\ flags}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00068}00068\ \ \ write\_lora\_packet(0x12,\ 0X00);}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00069}00069\ \}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00070}00070\ }
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00071}00071\ \textcolor{keywordtype}{void}\ write\_lora\_packet(uint8\_t\ address,\ uint8\_t\ payload)\ \{}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00072}00072\ \ \ uint16\_t\ return\_value\ \ \ \ \ =\ 0;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ clear\ varibles}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00073}00073\ \ \ uint16\_t\ payload\_to\_send\ \ =\ 0;}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00074}00074\ \ \ payload\_to\_send\ \ \ \ \ \ \ \ \ \ \&=\ (\string~(0XFFFF));\ \ \ \ \ \ \ \textcolor{comment}{//\ clear\ variable}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00075}00075\ \ \ payload\_to\_send\ \ \ \ \ \ \ \ \ \ |=\ (address\ <<\ 0x8);\ \ \textcolor{comment}{//\ load\ address\ into\ top\ 7\ bits}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00076}00076\ \ \ payload\_to\_send\ \ \ \ \ \ \ \ \ \ |=\ (1\ <<\ 0xF);\ \ \ \ \ \ \ \ \textcolor{comment}{//\ set\ rw\ bit\ to\ write}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00077}00077\ \ \ payload\_to\_send\ \ \ \ \ \ \ \ \ \ |=\ payload;\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ mask\ in\ data}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00078}00078\ \ \ GPIOD-\/>ODR\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&=\ (\string~(GPIO\_ODR\_OD0));\ \textcolor{comment}{//\ lower\ chip\ select}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00079}00079\ \ \ \textcolor{keywordflow}{while}\ ((SPI3-\/>SR\ \&\ SPI\_SR\_TXE)\ ==\ 0);\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ wait\ for\ transmission\ to\ be\ empty}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00080}00080\ \ \ SPI3-\/>DR\ =\ payload\_to\_send;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ load\ data\ reg}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00081}00081\ \ \ \textcolor{keywordflow}{while}\ ((SPI3-\/>SR\ \&\ SPI\_SR\_RXNE)\ ==\ 0);\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ wait\ for\ received\ data}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00082}00082\ \ \ return\_value\ =\ (uint16\_t)(SPI3-\/>DR);\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ see\ if\ it\ returns\ anything}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00083}00083\ \ \ \textcolor{keywordflow}{while}\ ((SPI3-\/>SR\ \&\ SPI\_SR\_BSY)\ ==\ 1);\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ wait\ for\ line\ to\ be\ clear}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00084}00084\ \ \ GPIOD-\/>ODR\ |=\ (GPIO\_ODR\_OD0);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ raise\ chip\ select}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00085}00085\ \}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00086}00086\ }
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00087}00087\ \textcolor{keywordtype}{void}\ configure\_LoRa\_module()\ \{}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00088}00088\ \ \ \textcolor{comment}{//\ send\_lora\_packet(\ address,\ \ payload)}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00089}00089\ \ \ \textcolor{comment}{//\ \ first\ read\ the\ RegOpMode\ to\ see\ what\ mode\ its\ i}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00090}00090\ \ \ uint8\_t\ regopmode;}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00091}00091\ \ \ uint8\_t\ TXPOINTER\_ADDRESS;}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00092}00092\ \ \ uint8\_t\ FIFOPOINTER\_ADDRESS;}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00094}00094\ \ \ write\_lora\_packet(0x40,\ 0x40);\ \ \ \ \ \ \ \textcolor{comment}{//\ cant\ remember\ what\ this\ does}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00095}00095\ \ \ regopmode\ =\ receive\_lora\_data(0X1);\ \ \textcolor{comment}{//\ read\ in\ modem\ statues}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00096}00096\ \ \ regopmode\ =\ 0;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ set\ status\ to\ sleep}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00097}00097\ \ \ write\_lora\_packet(0x1,\ regopmode);\ \ \ \textcolor{comment}{//\ put\ in\ sleep\ mode}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00098}00098\ \ \ regopmode\ \ =\ receive\_lora\_data(0X1);\ \textcolor{comment}{//\ read\ back\ status}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00099}00099\ \ \ regopmode\ |=\ 0X80;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ set\ relevent\ buts}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00100}00100\ \ \ write\_lora\_packet(0x1,\ regopmode);\ \ \ \textcolor{comment}{//\ set\ into\ LoRa\ mode}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00101}00101\ \ \ regopmode\ =\ receive\_lora\_data(0X1);\ \ \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00102}00102\ \ \ write\_lora\_packet(0x1D,\ 0x52);\ \ \ \ \ \ \ \textcolor{comment}{//\ REG\ MODEM\ CONFIG\ 1//\ not\ sure\ what\ configuration\ we\ want\ to\ actually\ use\ for\ 0x1D}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00104}00104\ \ \ write\_lora\_packet(0x1E,\ 0x94);\ \ \ \ \ \ \ \textcolor{comment}{//\ REG\ MODEM\ CONFIG\ 2}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00105}00105\ \ \ write\_lora\_packet(0x22,\ 0x10);\ \ \ \ \ \ \ \textcolor{comment}{//\ REG\ PAYLOAD\ LENGTH}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00106}00106\ \ \ write\_lora\_packet(0x23,\ 0x10);\ \ \ \ \ \ \ \textcolor{comment}{//\ REG\ PAYLOAD\ LENGTH}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00108}00108\ \ \ write\_lora\_packet(0x1D,\ 0X4A);\ \textcolor{comment}{//\ cant\ rememember\ what\ this\ is\ for}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00110}00110\ \ \ regopmode\ \ =\ receive\_lora\_data(0X1);}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00111}00111\ \ \ regopmode\ \&=\ (\string~(0x7));}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00112}00112\ \ \ regopmode\ |=\ 0x1;}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00113}00113\ \ \ write\_lora\_packet(0x1,\ regopmode);}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00114}00114\ \ \ regopmode\ =\ receive\_lora\_data(0X1);\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ SHOULD\ GET\ 0X81}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00116}00116\ \ \ TXPOINTER\_ADDRESS\ =\ receive\_lora\_data(0xE);\ \textcolor{comment}{//\ should\ be\ 80}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00117}00117\ \ \ write\_lora\_packet(0XD,\ 0X80);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ set\ pointer\ adddress\ to\ TX}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00118}00118\ \}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00119}00119\ }
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00120}00120\ uint8\_t\ receive\_lora\_data(uint8\_t\ address)\ \{}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00121}00121\ \ \ uint16\_t\ return\_value;}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00122}00122\ \ \ uint16\_t\ payload\_to\_send;}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00123}00123\ \ \ payload\_to\_send\ \&=\ (\string~(0XFFFF));}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00124}00124\ \ \ payload\_to\_send\ |=\ (address\ <<\ 0x8);}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00125}00125\ \ \ payload\_to\_send\ \&=\ (\string~(1\ <<\ 0xF));}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00126}00126\ \ \ \textcolor{keywordflow}{while}\ ((SPI3-\/>SR\ \&\ SPI\_SR\_TXE)\ ==\ 0);}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00127}00127\ \ \ GPIOD-\/>ODR\ \&=\ (\string~(GPIO\_ODR\_OD0));}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00128}00128\ \ \ SPI3-\/>DR\ \ \ \ =\ payload\_to\_send;}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00129}00129\ \ \ \textcolor{keywordflow}{while}\ ((SPI3-\/>SR\ \&\ SPI\_SR\_RXNE)\ ==\ 0);\ \textcolor{comment}{//\ wait\ for\ received\ data}}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00130}00130\ \ \ GPIOD-\/>ODR\ \ \ |=\ (GPIO\_ODR\_OD0);}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00131}00131\ \ \ return\_value\ \ =\ (uint16\_t)(SPI3-\/>DR);}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00132}00132\ \ \ \textcolor{keywordflow}{return}\ (uint8\_t)return\_value;}
\DoxyCodeLine{\Hypertarget{lora_8c_source_l00133}00133\ \}}

\end{DoxyCode}
